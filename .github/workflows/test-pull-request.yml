name: Test Pull Request

on:
  pull_request:
    paths:
      - "**"
  push:
    branches:
      - main
    paths:
      - "**"

jobs:
  package:
    name: Package
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Get version from buildpack.toml
        id: version
        run: |
          V=$(awk -F'"' '/^  version = / {print $2; exit}' buildpack.toml)
          echo "version=${V}" >> "$GITHUB_OUTPUT"

      - name: Package buildpack
        run: ./scripts/package.sh --version "${{ steps.version.outputs.version }}"

      - name: Verify buildpack.tgz
        run: |
          test -f build/buildpack.tgz
          tar tzf build/buildpack.tgz | head -5
